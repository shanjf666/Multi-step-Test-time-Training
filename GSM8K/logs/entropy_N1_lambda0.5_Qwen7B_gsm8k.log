Using device: cuda
正在加载语言模型...
Loading checkpoint shards:   0%|                                                                                                                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████████████████████████████                                                                                                                                             | 1/4 [00:00<00:01,  2.78it/s]Loading checkpoint shards:  50%|██████████████████████████████████████████████████████████████████████████████████████████████                                                                                              | 2/4 [00:00<00:00,  3.11it/s]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                               | 3/4 [00:00<00:00,  3.33it/s]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:01<00:00,  3.62it/s]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:01<00:00,  3.42it/s]
Traceback (most recent call last):
  File "/root/autodl-tmp/Multi-step-Test-time-Training/GSM8K/main.py", line 217, in <module>
    main()
  File "/root/autodl-tmp/Multi-step-Test-time-Training/GSM8K/main.py", line 104, in main
    ).to(device)
      ^^^^^^^^^^
  File "/root/miniconda3/lib/python3.12/site-packages/transformers/modeling_utils.py", line 4341, in to
    return super().to(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/root/miniconda3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1355, in to
    return self._apply(convert)
           ^^^^^^^^^^^^^^^^^^^^
  File "/root/miniconda3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 915, in _apply
    module._apply(fn)
  File "/root/miniconda3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 915, in _apply
    module._apply(fn)
  File "/root/miniconda3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 915, in _apply
    module._apply(fn)
  [Previous line repeated 2 more times]
  File "/root/miniconda3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 942, in _apply
    param_applied = fn(param)
                    ^^^^^^^^^
  File "/root/miniconda3/lib/python3.12/site-packages/torch/nn/modules/module.py", line 1341, in convert
    return t.to(
           ^^^^^
torch.OutOfMemoryError: CUDA out of memory. Tried to allocate 130.00 MiB. GPU 0 has a total capacity of 31.47 GiB of which 133.31 MiB is free. Process 153747 has 24.68 GiB memory in use. Including non-PyTorch memory, this process has 6.65 GiB memory in use. Of the allocated memory 6.41 GiB is allocated by PyTorch, and 2.72 MiB is reserved by PyTorch but unallocated. If reserved but unallocated memory is large try setting PYTORCH_CUDA_ALLOC_CONF=expandable_segments:True to avoid fragmentation.  See documentation for Memory Management  (https://pytorch.org/docs/stable/notes/cuda.html#environment-variables)
Using device: cuda
正在加载语言模型...
Loading checkpoint shards:   0%|                                                                                                                                                                                                    | 0/4 [00:00<?, ?it/s]Loading checkpoint shards:  25%|███████████████████████████████████████████████                                                                                                                                             | 1/4 [00:00<00:01,  2.31it/s]Loading checkpoint shards:  50%|██████████████████████████████████████████████████████████████████████████████████████████████                                                                                              | 2/4 [00:00<00:00,  2.78it/s]Loading checkpoint shards:  75%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████                                               | 3/4 [00:01<00:00,  3.11it/s]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:01<00:00,  3.50it/s]Loading checkpoint shards: 100%|████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 4/4 [00:01<00:00,  3.20it/s]
语言模型加载完成!
正在加载数据集...
{'question': "Janet’s ducks lay 16 eggs per day. She eats three for breakfast every morning and bakes muffins for her friends every day with four. She sells the remainder at the farmers' market daily for $2 per fresh duck egg. How much in dollars does she make every day at the farmers' market?", 'answer': 'Janet sells 16 - 3 - 4 = <<16-3-4=9>>9 duck eggs a day.\nShe makes 9 * 2 = $<<9*2=18>>18 every day at the farmer’s market.\n#### 18'}
数据集加载完成，共2个样本
开始执行基于步骤的置信度评估...
Processing: 0it [00:00, ?it/s]Processing: 0it [00:09, ?it/s, accuracy=1.0000]Processing: 1it [00:09,  9.49s/it, accuracy=1.0000]Processing: 1it [00:14,  9.49s/it, accuracy=1.0000]Processing: 2it [00:14,  6.85s/it, accuracy=1.0000]Processing: 2it [00:14,  7.25s/it, accuracy=1.0000]

--- 样本 1 调试信息 ---
问题: Janet’s ducks lay 16 eggs per day. She eats three for breakfast every morning and bakes muffins for her friends every day with four. She sells the remainder at the farmers' market daily for $2 per fresh duck egg. How much in dollars does she make every day at the farmers' market?
真实答案: 18
模型答案(提取): 18
清理后文本(保存的 answer): To determine how much Janet makes every day at the farmers' market, we need to follow these steps: 1. Calculate the total number of eggs Janet touches each day. 2. Determine how many eggs Janet eats. 3. Determine how many eggs Janet bakes. 4. Calculate the number of eggs Janet sells. 5. Calculate the total revenue from selling the eggs. Let's go through each step in detail: 1. **Total number of eggs Janet touches each day:** Janet's ducks lay 16 eggs per day. 2. **Eggs Janet eats:** Janet eats 3 eggs for breakfast every morning. \[ \text{Eggs eaten} = 3 \] 3. **Eggs Janet bakes:** Janet bakes 4 muffins for her friends every day, and each muffin requires 1 egg. \[ \text{Eggs baked} = 4 \] 4. **Eggs Janet sells:** The total number of eggs Janet touches each day is 16. After eating 3 eggs and baking 4 eggs, the number of eggs left to sell is: \[ \text{Eggs sold} = 16 - 3 - 4 = 9 \] 5. **Total revenue from selling the eggs:** Janet sells each fresh duck egg for $2. Therefore, the total revenue is: \[ \text{Total revenue} = 9 \times 2 = 18 \] Thus, Janet makes \(\boxed{18}\) dollars every day at the farmers' market.
最高置信度: 0.9451
是否正确: True
--- 结束调试信息 ---


--- 样本 2 调试信息 ---
问题: A robe takes 2 bolts of blue fiber and half that much white fiber.  How many bolts in total does it take?
真实答案: 3
模型答案(提取): 3
清理后文本(保存的 answer): To determine the total number of bolts needed for the robe, we need to consider both the blue and white fibers. 1. Identify the number of bolts of blue fiber required: The problem states that the robe takes 2 bolts of blue fiber. 2. Determine the number of bolts of white fiber required: The problem also states that the robe takes half as much white fiber as blue fiber. Since the robe takes 2 bolts of blue fiber, the number of bolts of white fiber is: \[ \frac{2}{2} = 1 \] 3. Calculate the total number of bolts needed: To find the total number of bolts, we add the number of bolts of blue fiber to the number of bolts of white fiber: \[ 2 + 1 = 3 \] Therefore, the total number of bolts needed for the robe is \(\boxed{3}\).
最高置信度: 0.9596
是否正确: True
--- 结束调试信息 ---

########################################################################################
Accuracy of Model@1: 1.0000.
Total samples: 2, Correct: 2
Elapsed time: 14.50 secs.
########################################################################################
Results saved to ./TTT_data/entropy_best_of_1_lambda_0.5_Qwen7B_GSM8K.json
########################################################################################
实验配置参数:
########################################################################################
                   method ===> entropy
    n_repetitive_sampling ===> 1
              temperature ===> 0.7
                    top_p ===> 1.0
               model_path ===> Qwen/Qwen2.5-Math-7B-Instruct
             save_to_json ===> True
        dataset_repo_name ===> openai/gsm8k
               max_tokens ===> 512
              subset_size ===> 2
            lambda_weight ===> 0.5
     confidence_threshold ===> -inf
        key_step_api_base ===> https://api.agicto.cn/v1
       key_step_api_model ===> qwen3-max-preview
     key_step_temperature ===> 0.2
########################################################################################
